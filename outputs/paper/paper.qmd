---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: "`r Sys.time()`"
date-format: "D MMMM YYYY"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.width=6.5, fig.height=2.8) 

# loading in relevant libraries
library(RColorBrewer)
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(tidyr)
library(readxl)
library(data.table)
library(lubridate)
library(haven)
library(readxl)
library(ggplot2)

### Input data ###
income_data_percentage<-read.csv(here::here("outputs/data/income_3years.csv"))
sex_data<-read.csv(here::here("outputs/data/sex_data.csv"))
race_data<-read.csv(here::here("outputs/data/race_data.csv"))
employee_status_data<-read.csv(here::here("outputs/data/employee_status_data.csv"))
industry_sector_data<-read.csv(here::here("outputs/data/industry_sector_data.csv"))
science_course_data<-read.csv(here::here("outputs/data/science_course_data.csv"))

```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, @sec-data and @sec-first-point. 



```{r, fig.height=8}
#| message: false
#| warning: false
#| echo: false
#| label: fig-1
#| fig-cap: "U.S. Income Distribution from 2014 to 2018"

# Make sure the order of the income level is the order we wanted
income_label <- c("LT $1000", "$1000 TO 2999", "$3000 TO 3999", "$4000 TO 4999", "$5000 TO 5999", "$6000 TO 6999", "$7000 TO 7999", "$8000 TO 9999", "$10000 - 14999", "$15000 - 19999", "$20000 - 24999", "$25000 OR MORE")

income_data_percentage$Income <- factor(income_data_percentage$Income, levels = income_label)

# Define color palette with 3 colors
fill_colors <- brewer.pal(n = 3, name = "RdYlBu")

# Generate graph
ggplot(income_data_percentage, aes(x = Income, y = Number, fill = as.factor(Year))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_manual(values = fill_colors) +
  labs(x = "Income Level", y = "Total Number of People", title = "U.S. Income Distribution by Year") +
  geom_text(aes(label = paste0(round(Percentage, 1), "%"), y = Number + 10), position = position_stack(vjust = 0.5), size = 2) +
  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +
  ylim(0, 2400)

```


# Data {#sec-data}



```{r}
#| message: false
#| warning: false
#| echo: false
#| label: fig-2
#| fig-cap: "U.S. Income Distribution by Sex"

# calculate the percentage of each sex group for each year
sex_data <- sex_data %>% 
  group_by(year) %>% 
  mutate(percentage = 100 * people / sum(people))

# generate graph
ggplot(sex_data, aes(x = year, y = people, 
                                 fill = sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage), "%"), y = people + 5), position = position_dodge(width = 1), size = 3) +
  labs(x = "Year", y = "People", fill = "Sex",title = "sex")


```



```{r}
#| message: false
#| warning: false
#| echo: false
#| label: fig-3
#| fig-cap: "U.S. Income Distribution by Race"

# calculate the percentage of each race group for each year
race_data <- race_data %>% 
  group_by(year) %>% 
  mutate(percentage = 100 * people / sum(people))

# generate graph
ggplot(race_data, aes(x = year, y = people, 
                                 fill = race)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage), "%"), y = people + 5), position = position_dodge(width = 2), size = 3) +
  labs(x = "Year", y = "People", fill = "Race",title = "race")

```




```{r}
#| message: false
#| warning: false
#| echo: false
#| label: fig-4
#| fig-cap: "U.S. Income Distribution by Employee Status"

# calculate the percentage of each employee status group for each year
employee_status_data <- employee_status_data %>% 
  group_by(year) %>% 
  mutate(percentage = 100 * people / sum(people))

# generate graph
ggplot(employee_status_data, aes(x = year, y = people, 
                                 fill = employee_status)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage), "%"), y = people + 5), position = position_dodge(width = 0.9), size = 3) +
  labs(x = "Year", y = "People", fill = "Employee Status",title = "employee status")

```

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: fig-5
#| fig-cap: "U.S. Income Distribution by Industry Sector"

# calculate the percentage of each industry sector group for each year
industry_sector_data <- industry_sector_data %>% 
  group_by(year) %>% 
  mutate(percentage = 100 * people / sum(people))

# generate graph
ggplot(industry_sector_data, aes(x = year, y = people, 
                                 fill = industry_sector)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage), "%"), y = people + 5), position = position_dodge(width = 0.9), size = 3) +
  labs(x = "Year", y = "People", fill = "Industry Sector",title = "industry sector")


```

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: fig-6
#| fig-cap: "U.S. Income Distribution by College Level Science Courses"

# calculate the percentage of taking college level science courses for each year
science_course_data <- science_course_data %>% 
  group_by(year) %>% 
  mutate(percentage = 100 * people / sum(people))

# generate graph
ggplot(science_course_data, aes(x = year, y = people, 
                                 fill = science_course)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage), "%"), y = people + 5), position = position_dodge(width = 0.9), size = 3) +
  labs(x = "Year", y = "People", fill = "Whether taking science course",title = "Science course")

```


# Results

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


